<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Amex Split Tracker</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
  --bg:#0b0f19;
  --card:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.6);

  /* Yousef – Olive Green */
  --blue:#617741;
  --blueDark:#2b361a;

  /* Aleeya – Baby Pastel Pink */
  --pink:#f2a7c4;
  --pinkDark:#e3518b;
}


*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  color:var(--text);

  background:
    radial-gradient(
      900px at 20% -20%,
      rgba(242,167,196,.35) 0%,
      rgba(242,167,196,0) 60%
    ),
    radial-gradient(
      1000px at 80% 10%,
      rgba(97,119,65,.35) 0%,
      rgba(97,119,65,0) 65%
    ),
    #0b0f19;
}

.wrap{max-width:480px;margin:0 auto;padding:16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;margin-bottom:14px}

h2{
  margin:0 0 10px 0;
  font-weight:700;
  letter-spacing:-.01em;
}

h3{
  margin:0 0 10px 0;
  font-weight:800;
}
.row{display:flex;justify-content:space-between;align-items:center;font-size:14px;margin-top:6px}
.dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}
.kpiGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.kpi{text-align:center}
.mid{font-size:18px;font-weight:900}
.mid.remaining{font-size:26px; letter-spacing:-.02em;}
.sub{font-size:12px;color:var(--muted)}
canvas{max-width:100%}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:
    0 10px 30px rgba(0,0,0,.25),
    inset 0 1px 0 rgba(255,255,255,.04);
  transition:transform .2s ease, box-shadow .2s ease;
}

.card:active{
  transform:translateY(1px);
}

/* KPI Headings */ 
.kpi.yousef h3{color:var(--blue);}
.kpi.aleeya h3{color:var(--pink);}

/* Pie */
.pieWrap{position:relative}
.pieCenter{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  pointer-events:none;
}

#pcTitle{
  font-size:12px;
  letter-spacing:.06em;
  color:var(--muted);
}


#pcTotal{
  font-size:28px;
  font-weight:800;
  letter-spacing:-.01em;
  margin-top:4px;
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
}


#pcTx{
  font-size:13px;   /* slightly bigger transactions */
}


/* Monthly */
.slider{overflow:hidden;border-radius:14px}
.slideTrack{display:flex;width:200%;transition:transform .25s ease}
.slide{width:50%}

/* Table */
.tableHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.segment{
  display:flex;
  width:100%;
  border:1px solid var(--border);
  border-radius:14px;
  overflow:hidden;
  margin-bottom:10px;
}

.segBtn{
  flex:1;
  background:none;
  border:0;
  padding:10px 0;
  font-size:13px;
  color:rgba(255,255,255,.55);
  cursor:pointer;
  transition:background .2s ease, color .2s ease, transform .1s ease;
}

.segBtn:active{
  transform:scale(.97);
}


.segBtn:not(:last-child){border-right:1px solid var(--border);}
.segBtn.active{background:rgba(255,255,255,.08); color:var(--text);}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.08)}
th{color:var(--muted);text-align:left}
.badge{padding:2px 8px;border-radius:999px;font-size:11px;border:1px solid rgba(255,255,255,.12)}

/* Paid Off Strike Through */ 
tr.paidOff {
  text-decoration: line-through;
  text-decoration-color: #ff4b4b;
  color: rgba(255,255,255,.55);
}

/* Repaid Strike Through */ 
tr.repaid {
  text-decoration: line-through;
  text-decoration-color: #35d07f;
  color: rgba(255,255,255,.55);
}

/* Dynamic Bar Actions */ 
.barAction{
  margin-top:10px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,.08);
  font-size:13px;
  line-height:1.4;
}

.barAction strong{
  font-size:18px;
  display:block;
}

.barAction .hint{
  color:var(--muted);
  font-size:12px;
}

.barAction .cta{
  margin-top:6px;
  color:var(--pink);
  font-weight:700;
}

.progress {
  margin-top:8px;
  height:6px;
  background:rgba(255,255,255,.08);
  border-radius:999px;
  overflow:hidden;
}

.progress > span {
  display:block;
  height:100%;
  border-radius:999px;
  transition:width .4s ease;
}


</style>
</head>

<body>
<div class="wrap">

<!-- PIE -->
<div class="card">
  <h2>Spending</h2>
  <div class="pieWrap">
    <canvas id="pie" height="220"></canvas>
    <div class="pieCenter">
      <div id="pcTitle">Total</div>
      <div id="pcTotal">£0</div>
      <div class="sub" id="pcTx">0 transactions</div>
    </div>
  </div>
</div>

<!-- KPIs -->
<div class="kpiGrid">
  <div class="card kpi yousef">
    <h3>Yousef</h3>
    <div class="sub">Outstanding</div>
    <div class="mid remaining" id="yr">£0</div>
    <div class="sub">Repaid</div>
    <div class="mid" id="yp">£0</div>
    <div class="progress">
      <span id="ypProg" style="background:var(--blue);width:0%"></span>
    </div>
  </div>
  <div class="card kpi aleeya">
    <h3>Aleeya</h3>
    <div class="sub">Outstanding</div>
    <div class="mid remaining" id="ar">£0</div>
    <div class="sub">Repaid</div>
    <div class="mid" id="ap">£0</div>
    <div class="progress">
      <span id="apProg" style="background:var(--pink);width:0%"></span>
    </div>

  </div>
</div>

<!-- MONTHLY -->
<div class="card" id="monthCard">
  <h2 id="monthLabel">—</h2>

  <div class="slider">
    <div class="slideTrack">
      <div class="slide">
        <canvas id="bar" height="160"></canvas>
      </div>
      <div class="slide"></div>
    </div>
  </div>

  <!-- Action callout lives here -->
  <div class="barAction" id="barAction" hidden></div>
</div>


<!-- TABLE -->
<div class="card">
  <div class="tableHeader">
    <h2>Transactions</h2>
  </div>

  <div class="segment segment-full">
    <button class="segBtn active" id="fltDue">Outstanding</button>
    <button class="segBtn" id="fltAll">All</button>
    <button class="segBtn" id="fltSpent">Spent</button>
    <button class="segBtn" id="fltPaid">Paid</button>
  </div>

  <table>
    <thead>
      <tr><th>Date</th><th>Type</th><th>Description</th><th>Amount</th></tr>
    </thead>
    <tbody id="aLedger"></tbody>
  </table>
</div>

</div>

<script>
const $ = id => document.getElementById(id);

const cssVar = name =>
  getComputedStyle(document.documentElement).getPropertyValue(name).trim();

const GBP = n => new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(Math.max(0,n||0));
const displayType = type =>
  type === "paid" ? "Paid" :
  type === "spent" ? "Spend" :
  type;

const parseDate = s => {
  const p=String(s||"").split(/[\/-]/);
  if(p.length!==3) return null;
  const d=new Date(p[2],p[1]-1,p[0]);
  return isNaN(d)?null:d;
};
const monthKey = d => d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0");
const monthPretty = k => new Date(k.split("-")[0],k.split("-")[1]-1)
  .toLocaleDateString("en-GB",{month:"long",year:"numeric"});

const fade = (color, alpha=0.35) =>
  color.startsWith("rgb")
    ? color.replace("rgb", "rgba").replace(")", `,${alpha})`)
    : color + Math.round(alpha*255).toString(16).padStart(2,"0");


function animateNumber(el, from, to, duration=300){
  const start = performance.now();
  function tick(now){
    const p = Math.min((now - start) / duration, 1);
    const v = from + (to - from) * p;
    el.textContent = GBP(v);
    if(p < 1) requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

function animateInt(el, from, to, suffix="", durat